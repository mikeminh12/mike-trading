<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniTrade Demo</title>
  <style>
    body{font-family:system-ui,Arial;background:#f3f4f6;padding:20px}
    .card{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.08);max-width:700px;margin:12px auto}
    input,button{padding:8px;margin:6px 0}
    .row{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <div class="card">
    <h2>MiniTrade (Demo) — GitHub Pages + Google Sheets</h2>
    <div>
      <strong>API:</strong> <span id="apiUrl"></span>
    </div>
    <hr>
    <div>
      <h3>Register</h3>
      <input id="regUser" placeholder="username" />
      <input id="regPass" placeholder="password" type="password" />
      <button onclick="register()">Register</button>
    </div>

    <div>
      <h3>Login</h3>
      <input id="loginUser" placeholder="username" />
      <input id="loginPass" placeholder="password" type="password" />
      <button onclick="login()">Login</button>
    </div>

    <div id="walletArea" style="display:none">
      <h3>Wallet — <span id="who"></span></h3>
      <div>USD: <span id="usd">0</span></div>
      <div>MYC: <span id="myc">0</span></div>

      <div style="margin-top:10px">
        <input id="amt" placeholder="amount (MYC)" type="number" step="0.000001" />
        <select id="side"><option value="buy">Buy</option><option value="sell">Sell</option></select>
        <button onclick="trade()">Submit</button>
      </div>
    </div>

    <div style="margin-top:12px">
      <button onclick="logout()">Logout</button>
    </div>

    <hr>
    <div>
      <small>Note: replace <code>API_URL</code> bên dưới bằng URL Apps Script đã deploy.</small>
    </div>
  </div>

<script>
const API_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgPPU4XBYSV6soq7jkkuvUVbomksqUi8VGwg1vBGXCB-PXJW6hwJeYhJiH_59hgUZW7_exJ3uv8aZ3PAnX83FbsyBkGS-M3w7JcUcLwVclQwvQSe3_vK6ljSqE180lE6XXti_evH3Z8JpzKmHONpXKMajQqcD8sgoOaB00fv_0GoP1ZZ9T0HY89OfnOJMVLqFt0QsI3MrG8j5O1Yd2hYmhKoytlO1P9fe3lSi7aldY3rakl1Xju7lvuRfWTRrCK03CVWIX-KT46Ueq6AFZ4mnMqbUXgeK-MDy4yNc_G&lib=MsLElbyip4PZ3U1U50o2BX15nCUw6EsM-"; // <-- THAY CHỖ NÀY
document.getElementById('apiUrl').innerText = API_URL || 'CHƯA ĐƯA API_URL';

async function apiPost(payload){
  try{
    const r = await fetch(API_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    return await r.json();
  } catch(e){
    alert('API error: '+e.message);
    console.error(e);
  }
}

async function register(){
  const username = document.getElementById('regUser').value.trim();
  const password = document.getElementById('regPass').value.trim();
  if(!username || !password) return alert('Nhập user+pass');
  const res = await apiPost({ action: 'register', username, password });
  if(res && res.status === 'success'){ alert('Đăng ký OK, đăng nhập thôi'); }
  else alert('Err: '+(res.message||JSON.stringify(res)));
}

async function login(){
  const username = document.getElementById('loginUser').value.trim();
  const password = document.getElementById('loginPass').value.trim();
  if(!username||!password) return alert('Nhập user+pass');
  const res = await apiPost({ action: 'login', username, password });
  if(res && res.status === 'success'){
    localStorage.setItem('mt_user', username);
    renderWallet(res.usd, res.mycoin, username);
  } else alert('Login fail: '+(res.message||JSON.stringify(res)));
}

function renderWallet(usd,myc,username){
  document.getElementById('walletArea').style.display='block';
  document.getElementById('who').innerText = username;
  document.getElementById('usd').innerText = usd;
  document.getElementById('myc').innerText = myc;
}

function logout(){
  localStorage.removeItem('mt_user');
  document.getElementById('walletArea').style.display='none';
}

async function trade(){
  const username = localStorage.getItem('mt_user');
  if(!username) return alert('Login đã bro');
  const amount = Number(document.getElementById('amt').value);
  const side = document.getElementById('side').value;
  if(!amount || amount <= 0) return alert('Nhập amount > 0');
  const res = await apiPost({ action: 'trade', username, side, amount });
  if(res && res.status === 'success'){
    renderWallet(res.usd, res.mycoin, username);
    alert('Trade OK @ price ' + res.price);
  } else alert('Trade fail: '+(res.message||JSON.stringify(res)));
}
</script>
</body>
</html>
